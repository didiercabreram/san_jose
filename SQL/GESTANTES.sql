-- GESTANTES, PARTOS, ABORTOS

SELECT DISTINCT
    GENPACIEN.PACNUMDOC AS Número,
    CASE 
        WHEN GENPACIEN.GPASEXPAC = 1 THEN 'M' 
        WHEN GENPACIEN.GPASEXPAC = 2 THEN 'F' 
        ELSE NULL 
    END AS sexo,
    ADNINGRESO.AINCONSEC as ingreso,
    DATEDIFF(YEAR, GENPACIEN.GPAFECNAC, ADNINGRESO.AINFECING) - 
        CASE 
            WHEN (MONTH(GENPACIEN.GPAFECNAC) > MONTH(ADNINGRESO.AINFECING) OR  
                 (MONTH(GENPACIEN.GPAFECNAC) = MONTH(ADNINGRESO.AINFECING) AND DAY(GENPACIEN.GPAFECNAC) > DAY(ADNINGRESO.AINFECING))) 
            THEN 1 
            ELSE 0 
        END AS edad,
    GENDIAGNO.DIACODIGO,
    GENDIAGNO.DIANOMBRE,
    CASE
        WHEN GENDIAGNO.DIACODIGO IN ('O100','O101','O102','O103','O104','O109','O11X','O120','O121','O122','O13X','O140','O141','O142','O149','O150','O151','O152','O159','O16X','O200','O208','O209','O210','O211','O212','O218','O219','O220','O221','O222','O223','O224','O225','O228','O229','O230','O231','O232','O233','O234','O235','O239','O240','O241','O242','O243','O244','O249','O25X','O260','O261','O262','O263','O264','O265','O266','O267','O268','O269','O280','O281','O282','O283','O284','O285','O288','O289','O290','O291','O292','O293','O294','O295','O296','O298','O299','O300','O301','O302','O308','O309','O311','O318','O320','O321','O322','O323','O324','O325','O326','O328','O329','O330','O331','O332','O333','O334','O335','O336','O337','O338','O339','O340','O341','O342','O343','O344','O345','O346','O347','O348','O349','O350','O351','O352','O353','O354','O355','O356','O357','O358','O359','O360','O361','O362','O363','O365','O366','O367','O368','O369','O40X','O410','O411','O418','O419','O420','O421','O422','O429','O430','O431','O432','O438','O439','O450','O458','O459','O470','O471','O479','O48X','O710','O712','O715','O716','O717','O718','O719','O880','O881','O882','O883','O888','O93X','O980','O981','O982','O983','O984','O985','O986','O987','O988','O989','O990','O991','O992','O993','O994','O995','O996','O997','O998','P080','P081','P082','Z321','Z33X','Z340','Z348','Z349','Z350','Z351','Z352','Z353','Z354','Z355','Z356','Z357','Z358','Z359','Z640')
		THEN 'Gestantes'
        WHEN GENDIAGNO.DIACODIGO IN ('O000','O001','O002','O008','O009','O010','O011','O019','O020','O021','O028','O029','O030','O031','O032','O033','O034','O035','O036','O037','O038','O039','O040','O041','O042','O043','O044','O045','O046','O047','O048','O049','O050','O051','O052','O053','O054','O055','O056','O057','O058','O059','O060','O061','O062','O063','O064','O065','O066','O067','O068','O069','O070','O071','O072','O073','O074','O075','O076','O077','O078','O079','O080','O081','O082','O083','O084','O085','O086','O087','O088','O089','O312','O364','P964')
		THEN 'Abortos'
        WHEN GENDIAGNO.DIACODIGO IN ('O95X','O960','O961','O969','O970','O971','O979','O310','O440','O441','O460','O468','O469','O600','O601','O602','O603','O60X','O610','O611','O618','O619','O620','O621','O622','O623','O624','O628','O629','O630','O631','O632','O639','O640','O641','O642','O643','O644','O645','O648','O649','O650','O651','O652','O653','O654','O655','O658','O659','O660','O661','O662','O663','O664','O665','O668','O669','O670','O678','O679','O680','O681','O682','O683','O688','O689','O690','O691','O692','O693','O694','O695','O698','O699','O700','O701','O702','O703','O709','O711','O713','O714','O720','O721','O722','O723','O730','O731','O740','O741','O742','O743','O744','O745','O746','O747','O748','O749','O750','O751','O752','O753','O754','O755','O756','O757','O758','O759','O800','O801','O808','O809','O810','O811','O812','O813','O814','O815','O820','O821','O822','O828','O829','O830','O831','O832','O833','O834','O838','O839','O840','O841','O842','O848','O849','O85X','O860','O861','O862','O863','O864','O868','O870','O871','O872','O873','O878','O879','O890','O891','O892','O893','O894','O895','O896','O898','O899','O900','O901','O902','O903','O904','O905','O908','O909','O910','O911','O912','O920','O921','O922','O923','O924','O925','O926','O927','O94X')
		THEN 'Parto'
        ELSE 'Otro'
    END AS Grupo_Diagnostico
FROM ADNINGRESO
INNER JOIN HCNFOLIO ON HCNFOLIO.ADNINGRESO = ADNINGRESO.OID
INNER JOIN GENPACIEN ON HCNFOLIO.GENPACIEN = GENPACIEN.OID
INNER JOIN HCNDIAPAC ON HCNFOLIO.OID = HCNDIAPAC.HCNFOLIO
INNER JOIN GENDIAGNO ON GENDIAGNO.OID = HCNDIAPAC.GENDIAGNO
WHERE ADNINGRESO.AINFECING BETWEEN CONVERT(DATETIME, '2024-09-01', 120) AND CONVERT(DATETIME, '2024-09-09', 120)
AND GENDIAGNO.DIACODIGO IN ('O95X','O960','O961','O969','O970','O971','O979','O310','O440','O441','O460','O468','O469','O600','O601','O602','O603','O60X','O610','O611','O618','O619','O620','O621','O622','O623','O624','O628','O629','O630','O631','O632','O639','O640','O641','O642','O643','O644','O645','O648','O649','O650','O651','O652','O653','O654','O655','O658','O659','O660','O661','O662','O663','O664','O665','O668','O669','O670','O678','O679','O680','O681','O682','O683','O688','O689','O690','O691','O692','O693','O694','O695','O698','O699','O700','O701','O702','O703','O709','O711','O713','O714','O720','O721','O722','O723','O730','O731','O740','O741','O742','O743','O744','O745','O746','O747','O748','O749','O750','O751','O752','O753','O754','O755','O756','O757','O758','O759','O800','O801','O808','O809','O810','O811','O812','O813','O814','O815','O820','O821','O822','O828','O829','O830','O831','O832','O833','O834','O838','O839','O840','O841','O842','O848','O849','O85X','O860','O861','O862','O863','O864','O868','O870','O871','O872','O873','O878','O879','O890','O891','O892','O893','O894','O895','O896','O898','O899','O900','O901','O902','O903','O904','O905','O908','O909','O910','O911','O912','O920','O921','O922','O923','O924','O925','O926','O927','O94X','O000','O001','O002','O008','O009','O010','O011','O019','O020','O021','O028','O029','O030','O031','O032','O033','O034','O035','O036','O037','O038','O039','O040','O041','O042','O043','O044','O045','O046','O047','O048','O049','O050','O051','O052','O053','O054','O055','O056','O057','O058','O059','O060','O061','O062','O063','O064','O065','O066','O067','O068','O069','O070','O071','O072','O073','O074','O075','O076','O077','O078','O079','O080','O081','O082','O083','O084','O085','O086','O087','O088','O089','O312','O364','P964','O100','O101','O102','O103','O104','O109','O11X','O120','O121','O122','O13X','O140','O141','O142','O149','O150','O151','O152','O159','O16X','O200','O208','O209','O210','O211','O212','O218','O219','O220','O221','O222','O223','O224','O225','O228','O229','O230','O231','O232','O233','O234','O235','O239','O240','O241','O242','O243','O244','O249','O25X','O260','O261','O262','O263','O264','O265','O266','O267','O268','O269','O280','O281','O282','O283','O284','O285','O288','O289','O290','O291','O292','O293','O294','O295','O296','O298','O299','O300','O301','O302','O308','O309','O311','O318','O320','O321','O322','O323','O324','O325','O326','O328','O329','O330','O331','O332','O333','O334','O335','O336','O337','O338','O339','O340','O341','O342','O343','O344','O345','O346','O347','O348','O349','O350','O351','O352','O353','O354','O355','O356','O357','O358','O359','O360','O361','O362','O363','O365','O366','O367','O368','O369','O40X','O410','O411','O418','O419','O420','O421','O422','O429','O430','O431','O432','O438','O439','O450','O458','O459','O470','O471','O479','O48X','O710','O712','O715','O716','O717','O718','O719','O880','O881','O882','O883','O888','O93X','O980','O981','O982','O983','O984','O985','O986','O987','O988','O989','O990','O991','O992','O993','O994','O995','O996','O997','O998','P080','P081','P082','Z321','Z33X','Z340','Z348','Z349','Z350','Z351','Z352','Z353','Z354','Z355','Z356','Z357','Z358','Z359','Z640')
AND GENPACIEN.GPASEXPAC = 2





/*
SELECT DISTINCT
--ADNINGRESO.AINCONSEC as ingreso,
--GENPACIEN.PACNUMDOC AS A_NODOC_4,
--HCNFOLIO.HCFECFOL,
						--CASE WHEN GENPACIEN.GPASEXPAC = 1 THEN 'M' WHEN GENPACIEN.GPASEXPAC = 2 THEN 'F' ELSE NULL END AS sexo,
                        HCNMEDPAC.HCSINTRAH,
                        INNPRODUC.IPRCODIGO,
                        INNPRODUC.IPRDESCOR
                    FROM
                        ADNINGRESO
						INNER JOIN HCNFOLIO ON HCNFOLIO.ADNINGRESO = ADNINGRESO.OID
                    INNER JOIN
                        GENPACIEN ON HCNFOLIO.GENPACIEN = GENPACIEN.OID
                    INNER JOIN
                        HCNMEDPAC ON HCNFOLIO.OID = HCNMEDPAC.HCNFOLIO
                    INNER JOIN
                        INNPRODUC ON HCNMEDPAC.INNPRODUC = INNPRODUC.OID
					

                    WHERE
                        HCNFOLIO.HCFECFOL BETWEEN CONVERT(DATETIME, '2024-08-01', 120) AND CONVERT(DATETIME, '2024-09-01', 120)
                        --AND INNPRODUC.IPRCODIGO IN ('DMT0001253')
                        and HCNMEDPAC.HCSINTRAH = 1
						AND GENPACIEN.GPASEXPAC = 2
                    --ORDER BY
                    --    HCNFOLIO.HCFECFOL DESC;
*/

